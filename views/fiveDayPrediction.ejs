<%- include partials/header %>
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>


       <style type="text/css">
       
           li.nav-item.sidebars.active {
             background: #b7b9cc;
             color: white;
           }
           li.nav-item.sidebars {
               color: white;
               background: #b7b9cc;
           }

           #dataTabletwo{
             display:content;
           }
           
           </style>
           
           
           </head>
           
           <div class="container" style="margin-top: -30px;">
           <section class="section-content py-3">
             <div class="row">
                <aside class="col-lg-3"> 
           <!-- ============= COMPONENT ============== -->
                 <nav class="sidebar card py-2 mb-4" style="background: #b7b9cc;border: grey;margin-left: -15px;">
                   <h2 style="color: white;margin-left: 10px;">Analytics</h2> 
                   <ul class="nav flex-column" id="nav_accordion">
                   <li class="nav-item sidebars">
                     <a class="nav-link" id="StockLinks">Stock User Searched </a>
                   </li>
                   <li class="nav-item sidebars">
                     <a class="nav-link" id="StockSearchLink"> Stock By Date </a>
                   </li>
                   <li class="nav-item sidebars">
                     <a class="nav-link" id="TipSearchLink">Mentor Tip By Date </a>
                   </li>
                   <li class="nav-item sidebars">
                     <a class="nav-link" id="AISearchLink"> AI Tip Count By Date</a>
                   </li>
                   <li class="nav-item sidebars">
                     <a class="nav-link" id="SoicalSearchLink"> Social Chat Count By Date</a>
                   </li>
                    <li class="nav-item sidebars active">
                      <a class="nav-link" id="PredictionLink"> 5-Day Prediction</a>
                    </li>
                 </ul>
                 </nav>
           <!-- ============= COMPONENT END// ============== --> 
               </aside>
    <main class="col-lg-9">
              <h4>5-Day Prediction by Date </h4> 
             
              <div class="card-body">
                <form autocomplete="off" class="form" role="form">
                  <div class="form-row">                        
                      <label class="col-lg-2 col-form-label form-control-label">Start Date</label>
                      <div class="col-lg-3">
                        <input class="form-control" type="date" id="start_date" min="1997-01-01" max="2030-12-31" placeholder="yyyy-mm-dd">
                      </div>

                       <div class="col-lg-2">
                      </div>
                    
                       <label class="col-lg-2 col-form-label form-control-label">End Date</label>
                      <div class="col-lg-3">
                        <input class="form-control" type="date" id="end_date" min="1997-01-01" max="2030-12-31" placeholder="yyyy-mm-dd">
                      </div>
                  </div>
                  <br>
                  <div class="form-group row">
                    <label class="col-lg-3 col-form-label form-control-label"></label>
                    <div class="col-lg-9">
                      <input class="btn btn-secondary" type="reset" value="Cancel"> 
                      <input class="btn btn-primary" type="button" value="Search" id="MentorBtnData">
                     </div>
                  </div>
                </form>
                  <div class="h5 mb-0 font-weight-bold text-gray-800">Total Counts : <span id="countTipData">0</span></div> 
              <ul class="nav nav-tabs" role="tablist">
               <li class="nav-item">
                 <a class="nav-link active" data-toggle="tab" href="#tabs-banner1" role="tab">Prediction by Date</a>
               </li>
               <li class="nav-item">
                 <a class="nav-link" data-toggle="tab" href="#tabs-banner2" role="tab">Prediction by Count</a>
               </li>
               </ul>
               <div class="tab-content">
              
               <div class="tab-pane active" id="tabs-banner1" role="tabpanel">
                <br>
                <h5>Prediction by Date</h5>
                <table class="table"  id="dataTableone">
                    <thead>
                      <tr>
                        <th scope="col">Symbol</th>
                        <th scope="col">Username</th>
                        <th scope="col">Date</th>
                      </tr>
                    </thead>
                    <tbody>
                      
                     
                    </tbody>
                  </table>
               </div>
               <div class="tab-pane" id="tabs-banner2" role="tabpanel">
                <br>
                <h5>Prediction by Count</h5>
                <table class="table" id="dataTabletwo">
                  <thead>
                    <tr>
                      <th scope="col">Stock Symbol</th>
                      <th scope="col">Count</th>
                      
                    </tr>
                  </thead>
                  <tbody>
                  
                  </tbody>
                </table>
               </div>
             </div>
              </div>

    </main>
  </div>
</section>

</div><!-- container //  -->

      </div>
      <!-- End of Main Content -->

                 <%- include partials/footer %>


    </div>
    <!-- End of Content Wrapper -->

  </div>
  <!-- End of Page Wrapper -->

  <!-- Scroll to Top Button-->
  <a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
  </a>

  <!-- Logout Modal-->
  <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
          <button class="close" type="button" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">Ã—</span>
          </button>
        </div>
        <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
          <a class="btn btn-primary" href="/">Logout</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap core JavaScript-->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Core plugin JavaScript-->
  <script src="vendor/jquery-easing/jquery.easing.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>
<script type="text/javascript">
  $(document).ready(function () {
//change selectboxes to selectize mode to be searchable
   $("select").select2();
});
</script>


 <!-- jQuery -->
 <script type="text/javascript" 
 src="https://code.jquery.com/jquery-3.5.1.js">
</script>

<!-- DataTables CSS -->
<link rel="stylesheet"
href=
"https://cdn.datatables.net/1.11.4/css/jquery.dataTables.min.css">

<!-- DataTables JS -->
<script src=
"https://cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js">
</script>

  <!-- Custom scripts for all pages-->
  <script src="js/sb-admin-2.min.js"></script>
<script src="js/choosen.js"></script>

 <!-- Page level plugins -->
  <!-- <script src="vendor/datatables/jquery.dataTables.min.js"></script> -->
  <!-- <script src="vendor/datatables/dataTables.bootstrap4.min.js"></script> -->

  <!-- Page level custom scripts -->
  <!-- <script src="js/demo/datatables-demo.js"></script> -->
  <script src="https://momentjs.com/downloads/moment.js"></script>

  <script type="text/javascript">

window.history.forward(); 
        function noBack() { 
            window.history.forward(); 
        } 

window.addEventListener("load", function() {

  var url_string = window.location.href; 
  var urls = new URL(url_string);
  var tokens = urls.searchParams.get("tokendata");
  $('#MentorBtnData').on('click', function() {
    var startDates = $('#start_date').val();
    // alert(moment(startDates).format("YYYY-MM-DD HH:mm:ss"));
    var finalstartdate = moment(startDates).format("YYYY-MM-DD HH:mm:ss");
    var endDates = $('#end_date').val();
    var finalenddate = moment(endDates).format("YYYY-MM-DD HH:mm:ss");
    var formdata = {fromDate : finalstartdate , toDate : finalenddate , limit:"100000" , offset :"0"};
    // $(document).ready(function () {
    //   $('#dataTablesf').DataTable({
  
    //     // Set the 3rd column of the
    //     // DataTable to ascending order
    //     order: [[2, 'asc']]
    //   });
    // }); 
      $.ajax({
        type: 'POST',
        url: 'https://apis.tradetipsapp.com/api/stockNonDefaultDateRecord/getStockNonDefaultDateRecordByDateFilter',
        headers: {
          Authorization: 'Bearer '+ tokens
        },
        data: formdata,
        success: function(data, textStatus, jqXHR)
        {
          // alert(data);
          var datak = JSON.stringify(data);
          var dataResultp = JSON.parse(datak); 
          var len = dataResultp.length;
          // // alert(len);
          if(len > 0){
          $('#dataTableone').empty();

          $("#countTipData").text("0");


           if ( $.fn.DataTable.isDataTable('#dataTableone') ) {
               $('#dataTableone').DataTable().destroy();
               
              }
            
          }


          $("#countTipData").text(len);

         
            $('#dataTableone').dataTable( {
            "aaData": data,   
            "lengthMenu": [ 500, 1000, 2000, 3000, 4000, 5000 ],
            "pageLength": 500,
            // "ordering": true,
            "columns": [
            
                { "data": "stockSymbol"},
               { "data": "userName"},
               { "data": "createdOn",
               "name":"date",
               "visible":true,
               "title":"Date Created",
               "render": function(data, type, full, meta){
                if(type == "display"){
                        var date = new Date(data);
                        var options = {year: "numeric", month: "long", day: "numeric"};

                        return date.toLocaleDateString('en-US', options);
                }

                return data;
              }

            }
            ], 
            "deferRender": true,
            rowCallback: function ( row, data ) {
          
        }



        });


        },

        error: function (jqXHR, textStatus, errorThrown)
        {
           alert("No data");
        }


      });
  
  });
  var form = new FormData();
form.append("limit", "500");
form.append("offset", "0");

var settings = {
  "url": "https://apis.tradetipsapp.com/api/stockNonDefaultCountRecord/getStockNonDefaultCountRecordByDate",
  "method": "POST",
  "headers": {
    "authorization": 'Bearer ' + tokens,
  },
  "processData": false,
  "contentType": false,
  "mimeType": "multipart/form-data",
  "data": form
}

$.ajax(settings).done(function (response) {
       var dataResultsdetail = JSON.parse(response); 
           $('#dataTabletwo').dataTable({
           "aaData": dataResultsdetail, 
           "lengthMenu": [ 500, 1000, 2000, 3000, 4000, 5000 ],
           "pageLength": 500,
           "order": [[ 1, "desc" ]],
             "columns": [
               
               { "data": "stockSymbol"},
               { "data": "count"}               
           ],
           "deferRender": true,
           rowCallback: function ( row, data ) {
           
       }

      });
});


////////////////////////////////////////////////////////////////////////////////

 var form1 = new FormData();
  form1.append("limit", "500");
  form1.append("offset", "0");

const url1 = "https://apis.tradetipsapp.com/api/stockNonDefaultDateRecord/getAllStockNonDefaultDateRecord";
fetch(url1, {
  method: "POST",
  headers: {
          Authorization: 'Bearer ' + tokens,
        },
  data:form1
})
  .then(resp => resp.json())
    .then(function(data) {
      // alert(data);
       var datak = JSON.stringify(data);
       var dataResults = JSON.parse(datak); 
       var totalds = dataResults.length;

        $("#countTipData").text(totalds);   
          $('#dataTableone').dataTable( {
           "aaData": dataResults, 
           "lengthMenu": [ 500, 1000, 2000, 3000, 4000, 5000 ],
           "pageLength": 500,
           "order": [[ 2, "desc" ]],
             "columns": [
               
               { "data": "stockSymbol"},
               { "data": "userName"},
               { "data": "createdOn",
               "name":"date",
               "visible":true,
               "title":"Date Created",
               "render": function(data, type, full, meta){
                if(type == "display"){
                        var date = new Date(data);
                        var options = {year: "numeric", month: "long", day: "numeric"};

                        return date.toLocaleDateString('en-US', options);
                }

                return data;
              }

            }

               
           ],
           "deferRender": true,
           rowCallback: function ( row, data ) {
           
       }

       });


       
  })
  .catch(function(error) {
    console.log(error);
  });

  

                 document.getElementById("StockLinks").href = "/stocklist?tokendata="+tokens;
              document.getElementById("StockSearchLink").href = "/searchStock?tokendata="+tokens;
              document.getElementById("TipSearchLink").href = "/alltipByDate?tokendata="+tokens;
              document.getElementById("AISearchLink").href = "/aiSearchByDate?tokendata="+tokens;
           document.getElementById("SoicalSearchLink").href = "/soicalSearchByDate?tokendata="+tokens;
           document.getElementById("PredictionLink").href = "/fiveDayPrediction?tokendata="+tokens;
});


 </script>
 
  <%- include partials/commonlink %>

          
</body>

</html>
